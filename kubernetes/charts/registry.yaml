apiVersion: apps/v1
kind: Deployment
metadata:
  name: private-repository-k8s
  labels:
    app: private-repository-k8s
spec:
  replicas: 1
  selector:
    matchLabels:
      app: private-repository-k8s
  template:
    metadata:
      labels:
        app: private-repository-k8s
    spec:
      volumes:
      - name: certs-vol
        secret:
          secretName: registry-creds
      - name: registry-vol
        hostPath:
          path: /opt/registry
          type: Directory

      containers:
        - image: registry:2
          name: private-repository-k8s
          imagePullPolicy: IfNotPresent
          env:
          - name: REGISTRY_HTTP_TLS_CERTIFICATE
            value: "/certs/registry.crt"
          - name: REGISTRY_HTTP_TLS_KEY
            value: "/certs/registry.key"
          ports:
            - containerPort: 5000
          volumeMounts:
          - name: certs-vol
            mountPath: /certs
          - name: registry-vol
            mountPath: /var/lib/registry

---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: private-repository-k8s
  name: private-repository-k8s
spec:
  ports:
  - port: 5000
    nodePort: 31320
    protocol: TCP
    targetPort: 5000
  selector:
    app: private-repository-k8s
  type: NodePort

---
apiVersion: v1
kind: Secret
metadata:
  name: registry-creds
data:
  registry.crt: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUYxVENDQTcyZ0F3SUJBZ0lVYUhBaWtrREwv
    dVpicUFwZ1U2MGkxNjVhZnlBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2VqRUxNQWtHQTFVRUJoTUNT
    VXd4RVRBUEJnTlZCQWdNQ0ZSbGJDQkJkbWwyTVJFd0R3WURWUVFIREFoVQpaV3dnUVhacGRqRVJN
    QThHQTFVRUNnd0lVR1Z5YzI5dVlXd3hFVEFQQmdOVkJBc01DRkJsY25OdmJtRnNNUjh3CkhRWURW
    UVFEREJad2NtbDJZWFJsTFhKbGNHOXphWFJ2Y25rdGF6aHpNQjRYRFRJeE1EY3lNVEV3TURVMU5s
    b1gKRFRNeE1EY3hPVEV3TURVMU5sb3dlakVMTUFrR0ExVUVCaE1DU1V3eEVUQVBCZ05WQkFnTUNG
    UmxiQ0JCZG1sMgpNUkV3RHdZRFZRUUhEQWhVWld3Z1FYWnBkakVSTUE4R0ExVUVDZ3dJVUdWeWMy
    OXVZV3d4RVRBUEJnTlZCQXNNCkNGQmxjbk52Ym1Gc01SOHdIUVlEVlFRRERCWndjbWwyWVhSbExY
    SmxjRzl6YVhSdmNua3Rhemh6TUlJQ0lqQU4KQmdrcWhraUc5dzBCQVFFRkFBT0NBZzhBTUlJQ0Nn
    S0NBZ0VBdjE2OHMrWjN3Q0luT1ArNXRaWlE3SEMyYmFZZgpWWTh0ZG1Jc082ZWZQZ2ZzMVFQUlJy
    WVRoVy9aU1ExdzhpaHVXRFBqdlliRURxOEdzbU5KSzFsNUt5TGdxc1p6Ck1aRERNeTFrZ3lSVzFD
    STNDRjdCb1JCY2JVcmJmazhZM3NsQUxKeWwvUmdmUnlENFBRYVJYbmlBZ09hUHJ3YzQKOFNmWndK
    QUJJOVo5emJCeVltaVMxK0pDeEV3QzBZbWdZRjdEaVltc0w5eUMzUlBBUGoyL2JjT2NzYkhOemh6
    QgpoN0dCb0N6TTU3ay9WOUZyMzV1SjhZMFlFU3VTK0lxRmRsME9MUFpHRTN4YUtzRTRCTE8zMFdv
    NWR0bnovOUxlClNWSTZvMXhGYkkzMkY5djZCbWlJRy9Kc2NNYk9iQjVtOEd0eGZaOE5KcFRCd1ZF
    bWdwaWtEcW80bU0wd0VPU0QKMEl2RE9xUmt5Y2lPS2VzUFl3bDN2UXhUajAyVmMxVi94bVpKYnhk
    Zk1QWTc2dGJybUphR01LUDB4Wm1uUWVYZApNOXBacDBxbXJLcUlsU25FdHdMZGNWeTZMRDNMMG8w
    YTNRM3lwTWtrR0dTZXphZGdmVUx4SU5Rc05EUXpGMTVnClVmLzB6ZTVISko2Rmhubmx1eTlOZzR5
    YjVvaWpOc3VFeEd5M2F5TjlJR2FjeXF0aDV2YkE0Z1JlUnhkNld3RDkKY21zR2pOYkZDbzNOaWs3
    bU9pTStNRTAvQVc0bnh0ZXNyb0VJSUJqZ3Zka2YvaGk4MUJhS0FVM2xodDVDdkM0ZwpoamI5TW80
    dkdDSkI3WnZPQ243YlZ6RHBERmhMQU5qNjE5MzNnVUlWMnF0SlZ3SGxEZkdZNkpXbXNEdHpWbnE4
    Ckt6c1A1bk55ZFowdm5Yc0NBd0VBQWFOVE1GRXdIUVlEVlIwT0JCWUVGTXVFQmRTTHNGSUUrOGpm
    bmM2VG81d1oKRHdTSk1COEdBMVVkSXdRWU1CYUFGTXVFQmRTTHNGSUUrOGpmbmM2VG81d1pEd1NK
    TUE4R0ExVWRFd0VCL3dRRgpNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dJQkFCR1o5dVhQ
    RDJ5V0grSnRKZDhMQ1RjUC82T0o3YjZuCk9oUlY0bUVEN1FwSUl3MXk3NFpzZjM2MG1kQUlOcG1o
    VVd3SFB5N1NSRnAwUHBWa0twYndZLzZ2TUZNYnVhVTQKdVlMV0pMRklnRm91MDJKVHFMSGJJVE1z
    eFJFWVUxYWY1WlJIMjJ6cldDM0J0QStWcHI0SitxaXE0U3BFTWRxTwpDcGhUTEVOc0J1N1oxWHQz
    M0JlYUJBUHJ1aURtSTViWG9iTmlqY292NXhRUEZPNVUrRVJjU3dSRGlTZk5EcFlVCnNQcjdPcmRU
    T2ZpWk80NlpmeDFaTmtwaE5rR0N6WlJYSnFvdzNJNUxkV3U2ZW5qVmJTdkFqWHVkZXg0S3V4SDMK
    Tmd3MHVYZU1hUnVCK0FJMDlnOW9EVkFkV3E5U09KSDhpVVE1RkFrMnVPeGdZb1VCZ25yc2xiblJv
    RDd6MlJZagpxWFJSVVg3UlpWTEdXNGhleU0rd1VXWTlWei9sZ3hIN3JieHNWTldTSGRINXdoQnoz
    TGlSWk4ycnJaNmZLVjVTClpYVDJTMUxrK3hhdDFBUGh2a3FTS1l4QTlaeGZYRGYwOGFnT2h0ODlh
    RlQwdmt6aWtiWXlVZWo4dFlBQlpsWlIKN1lLSkFPSEttM1Y4bk1UUXU4NW9oYW4zUVhIYS9pWnNK
    RGQ0SSs0cnk5NVpHWjFkaXg0ZE11NDAxOVlRRERXSQpER1FzT0NuUzExNHE5R0RXb3IxdjNhRVJj
    R1piTC80bkF3eENPcGd4R0ZrUmFRN0Uyb3dtZERuaXlXRnZuK2hWCmpSbDBtME5ncTJkdlJaeGJ6
    WHVnb05tOWNPWGhRcEk4VXJhMjhuWnd0UCtWQ0F0R0lSeGRSN25nem8zOGVMdnkKaXdXQU9WOCsz
    NUtICi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  registry.key: |
    LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRUUlCQURBTkJna3Foa2lHOXcwQkFRRUZB
    QVNDQ1Nzd2dna25BZ0VBQW9JQ0FRQy9Ycnl6NW5mQUlpYzQKLzdtMWxsRHNjTFp0cGg5Vmp5MTJZ
    aXc3cDU4K0IrelZBOUZHdGhPRmI5bEpEWER5S0c1WU0rTzloc1FPcndheQpZMGtyV1hrckl1Q3F4
    bk14a01NekxXU0RKRmJVSWpjSVhzR2hFRnh0U3R0K1R4amV5VUFzbktYOUdCOUhJUGc5CkJwRmVl
    SUNBNW8rdkJ6anhKOW5Ba0FFajFuM05zSEppYUpMWDRrTEVUQUxSaWFCZ1hzT0ppYXd2M0lMZEU4
    QSsKUGI5dHc1eXhzYzNPSE1HSHNZR2dMTXpudVQ5WDBXdmZtNG54alJnUks1TDRpb1YyWFE0czlr
    WVRmRm9xd1RnRQpzN2ZSYWpsMjJmUC8wdDVKVWpxalhFVnNqZllYMi9vR2FJZ2I4bXh3eHM1c0ht
    YndhM0Y5bncwbWxNSEJVU2FDCm1LUU9xamlZelRBUTVJUFFpOE02cEdUSnlJNHA2dzlqQ1hlOURG
    T1BUWlZ6VlgvR1prbHZGMTh3OWp2cTF1dVkKbG9Zd28vVEZtYWRCNWQwejJsbW5TcWFzcW9pVktj
    UzNBdDF4WExvc1BjdlNqUnJkRGZLa3lTUVlaSjdOcDJCOQpRdkVnMUN3ME5ETVhYbUJSLy9UTjdr
    Y2tub1dHZWVXN0wwMkRqSnZtaUtNMnk0VEViTGRySTMwZ1pwektxMkhtCjlzRGlCRjVIRjNwYkFQ
    MXlhd2FNMXNVS2pjMktUdVk2SXo0d1RUOEJiaWZHMTZ5dWdRZ2dHT0M5MlIvK0dMelUKRm9vQlRl
    V0cza0s4TGlDR052MHlqaThZSWtIdG04NEtmdHRYTU9rTVdFc0EyUHJYM2ZlQlFoWGFxMGxYQWVV
    Tgo4WmpvbGFhd08zTldlcndyT3cvbWMzSjFuUytkZXdJREFRQUJBb0lDQUJ5QlhoWm1BL3hvbWZN
    UmxIWUo5Ky9nCk1peFBER2ZRTmZObVdEUmltWVBCNW5Nc2FHWGlCVEpoSUxxUzkvbjZMOFdQcFNL
    OENrUXRxZyswWGxmSXNoWE0KMGk1ZDlSYXkrNENLQ0dqSVp1NmVVaGc3RlJpS3VWbkdScitmeEpL
    YTQ2WkJoekFXQWNLMGxJVnlqd0RGYms3RgpDUzRISTJJNGoyVHhqbG5xUHo3K1EydUpMQ1pnRzVY
    bHhKMjFwRi8yZmFYbERmTHJJOHNPZ0JwRlZGaGpSTm5yCkpEN0paY0p5bkY1aGpmd09TZk1vektx
    NEhtb09uRUVpZm5mckdrb3hQa1ZRUWN2eFAvVVNadWU4WldzYUtZa2MKbWczSE9Ua3V1SEZROHo1
    aVB2LzYwbGxXQk1BMDhoWXladGtRQmtGVm44Z1lndnIyT1k0MEtrcFZ0a3BBN01FRAp4eTEvM0Fi
    RGpoeWJYN2daaGc4NUlrTjhjZmE1TzI2RStqYUNWTWxoM2ZoTnUzcUJEbGJSY1huUHkxa1pjbUNN
    CkFwaHBlK05aQVJpL2N2NmtybCtiK0tIQ2JabERYZktjZnh3dUZma1VZYmMrUFV2MkUzcVlrTVRm
    ZVRGb0MvSUYKWlFIeTcxYW5MSlg2bHRybkJoK2M0clYyZWpGV1JBVkplYk15dXFQSVZGa3FQLzlC
    eXVuZ1hqWVp6THFQdHdiNgo2MGhnVnpMN0g0RTJ1US81eHhRUTdtN3I5WVNUYnJOWmdXNDlwK3Zs
    dnJlWlhzQURXTzQzT3ZNZitmOVUzb3JXClU5Qzc2VE1pNWI1T0YwT1hxWi9jTUx3a1RJdElTYVFD
    WFJWaDQraEVOd3dnczJCbjJQQm9BZ0cxaWpJZEo0dmIKR0V3UlJHZytVM3phUmNtRVY1dFJBb0lC
    QVFEeXNsVnZQbXZTM3V1eFBMYm8vVmxKd0dIak1NM0w2OExIRG9aMwpBZFIrcWptcEt6Zis0ZW96
    UGcrU1g0WEkzSWVST1NERStrOHVLSWw3Z3lxZUlTMGFJeWdoUlNKMGY2cTljcDY4ClE2TWE1aUFL
    RHVnMit1NzZXckN3M21leE9XL3lwZlFXcXRBVHZ1UlBQaUtHZnZqQWFPZW1VNG9ueUJHbGNWbkUK
    OUVISTcwM0w2M0l0NUF4NzY0QmVRd3d3TmhmM3AxKzliVk9zT2FRM3dINzlnbThUMmJvcThLa01y
    cU5kcitkZApFQkQxTDV5VkxkdGVyc2FSVGZadjZsaUd1VEtFSXlQS2hLWW1Tc3BrM2xraVAvTmpM
    SmdJOGJ3MEpwaDRNaW1WCmUxQjJKL1o1dTMwdXFEREVJRHlGckM5YXc0SnJZUytjUFVXd3psamhL
    VUI0VnU4OUFvSUJBUURKM0NoNGlRa04KdXV3bW1ZaDdjQkZSNmxjS2k5K1hOQW43OElSZ3ZVOVp0
    c0RsOHJoK1IyTDhUc2ZlVGpDaGFsTHpHektYZHNhTApQaUZQRVJpaXpJVG1DSVZwcVovUE96MmZK
    SlE4bmk4OW5BYmZLcjA2WmxTVUV1MEhtNlI5NlIxSE1GSlQ1VXgyCjUxNEdpOVBXY0RoZFlVZ21I
    dG1tajk3UVBDMlRMcnU3QTBvZUFMbjV1aEFUYyt4a0V1K3NrYjZFOEFEOW02MHYKdFhTWmdPRzIw
    TEk2bmJ1bFVYS3E1VUs3dm13clRrVDRTdXVzcHRaM0Q1SFhPcERLTk9TTDI0T3dwVnpyZ1F2MgpQ
    V3ByeDFjRjlIVlNlTmZydnV4cTdkODhvN3NGWFpjOTNyNDlzVmtNa0pHdTFpSW12M2hEZjNMRDg0
    dEVPNTVMCnpCY21SemhYQW9zWEFvSUJBSFE3ZW5WRHBPb2gveWtzRmNHeURFQXBGZmh6MkN2d3Bx
    RWswTHRRTWcvVHdMZkgKVGhNUTZWUlBSYS9wZGE1RUI5MUNTZkpzbXQxVlpycXprQWFaaHZzOG1T
    eU42cmwycHpRQ0lBbTBMdnBqK2pZMgorM25SWmdDYXpJSjRrWnFzRW5SWWpIVUtxNHE1WXFpYzdu
    WVJlMXJUSXhaaWJna3RaVjRoMGtka1g5azIyc0J0CjY0b1U3UEd3VVJOVDh4Tm41TVNqOFZOTWQ4
    VkUrZVFGbWd3Wm1zOGIrSEEyUUJBbDEzRzRIQXRTOVh3bnFFczkKNGhFUGpXUHJ2Ym5OdDBZV2po
    NEFvbFNNZ1BKWDRXUzdwRjZsMkEvSVBLd1Q4Zm5iL2l1YWdwWG5zQnBXZTFIRAp2R2xLL2NnQVZG
    d0VvYzFMVXp2UUdMZ3dGQjlnUStyYUVkbFFjVlVDZ2dFQVZ3aSt4bUhIYm8wV3Z2bloxK2NWCkFL
    MjZnOGlWU2h0YzVxem9WdEdwQWZTRExXSSsyK3VwcVVIS2VYWmJEMjNKZ0JwTThQTjhYWk1YUjRF
    R2owTUIKVmpGOFhIZVBlUW1BNHpvaFZCV2NKc004VDBLZFBpM2E3OUZOTThlTzM5OEFDYTZ6QUl0
    UU1jQkdVU28rMXltaAprOW1iQXh5d0dWblU1eEhiVUtlSXQvU09JMnVLeERyT0xhVUEycEV6bDhO
    clV1UXNlU3lET3B2UlAxSkxmOGh4CjRFWWNId2FFRzEwb0xjekgxTkExZXB6TENyRVFyVnNnTloy
    QnlqMk9BU05QbjMxZEdBbVcvNyt4UC9FOSswcFEKdjVOcy9hOWZQaWQ3NWlodVBiMEJ0ZUp4UWla
    U1Q5R1Jqc0d6RGVQbVZhd0E3cTMyY1NBSGU0VHV3a2xZNkdNbgpWd0tDQVFCQWIxbkFRSnpvWmFX
    OGlkY2FMRGdjdllDQzg5L1ZVZnNiMDVNdFd3RzM0UXJhb2J0NDd0TnJLdit2CnJVK1Fab2VrQmo3
    Z1plMTZmWTNGVERVajZhRm1VOS81TmdXZGthSjdwRUJoVVZwci9QbmF3K2I1bEVSclBVVXQKMnNj
    ZTh1c1dOUjBaQzBLcUhocTlPcWNpcEI2aVEvZ25EUVJhYnlKN1M5RHpUaWZPZGk5UXhNYlFWR2NQ
    VGxuRwpUdDdWemxWaUxDcUNadUhnTHM1UFJXcStFOWtrYnZ0eUdrN09lQVVDL1pDdk9qN0ZCR3BN
    djFXWFI2SXJmN044ClYvZjdPcVZ0MU9SN214dVRUQSthUndocnA0a0pFM1I3eElYM3VoWkhEMmVj
    YUE0aU00V1lrL0dUVEtBQkxjcFcKSHFGMmw0eUQ3bnlHVW02MnNhMFpobU11VDVkegotLS0tLUVO
    RCBQUklWQVRFIEtFWS0tLS0tCg==
